name: CI

on:
  push:
    branches:
      - '*'
  pull_request:
    branches: [ main ]

jobs:

## Build Back ##

  Test_Build_Back:
    uses: ./.github/workflows/build_back.yml

## Build App ##

  Test_Build_App:
    uses: ./.github/workflows/build_app.yml
    secrets: inherit

## Build Docker ##

  Test_Build_Docker:
    needs: [ Test_Build_Back, Test_Build_App ]
    uses: ./.github/workflows/build_docker.yml

## Test Backend ##

  Test_Back:
    needs: [ Test_Build_Back]
    uses: ./.github/workflows/test_back.yml
    secrets: inherit

## Test App ##

  Test_App:
    needs: [ Test_Build_App ]
    uses: ./.github/workflows/chromatic.yml
    secrets: inherit

## Deployement ##

  Deployement:
    if: github.ref == 'refs/heads/main'
    needs: [ Test_Build_Docker, Test_Back, Test_App ]
    uses: ./.github/workflows/deployment_docker.yml
    secrets: inherit


##############################################################################
#                        ADD NEW TASKS IN THE CI                             #
#                                                                            #
#                                                                            #
# ON this file                                                               #
# ADD name: NAME_OF_YOUR_TASK                                                #
# ADD need option if you want to wait for a previous task to be completed    #
# ADD uses: ./.github/workflows/NAME_OF_YOUR_FILE.yml                        #
# ADD secrets: inherit if you need to use your secrets                       #
#                                                                            #
# ON your file                                                               #
# ADD name: NAME_OF_YOUR_TASK                                                #
# ADD on: worflow_call:                                                      #
# ADD jobs:                                                                  #
# ADD NAME_OF_YOUR_JOB:                                                      #
# ADD runs-on: ubuntu-latest                                                 #
# ADD if: Specify conditions for when to run a job                           #
# ADD environment: Staging or Production                                     #
# ... Add your steps                                                         #
#                                                                            #
##############################################################################