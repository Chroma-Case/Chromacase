name: CI

on:
  push:
    branches:
      - '*'
  pull_request:
    branches: [ main ]

jobs:

## Build Back ##

  Test_Build_Back:
    uses: ./.github/workflows/build_back.yml

## Build App ##

  Test_Build_App:
    uses: ./.github/workflows/build_app.yml
    secrets: inherit

## Build Docker ##

  Test_Build_Docker:
    needs: [ Test_Build_Back, Test_Build_App ]
    uses: ./.github/workflows/build_docker.yml

## Test Backend ##

  Test_Back:
    needs: [ Test_Build_Back, Test_Build_App ]
    uses: ./.github/workflows/test_back.yml
    secrets: inherit

## Test App ##

  Test_App:
    needs: [ Test_Build_Back, Test_Build_App ]
    uses: ./.github/workflows/chromatic.yml
    secrets: inherit

## Deployement ##

  Deployement:
    if: github.ref == 'refs/heads/main'
    needs: [ Test_Build_Docker, Test_Back, Test_App ]
    uses: ./.github/workflows/deployment_docker.yml
    secrets: inherit


